<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="caijiQAQ">
    
    <title>
        
            计算机系统 |
        
        学习笔记
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"caiji-qaq.github.io","root":"/","language":"en"}
    KEEP.theme_config = {"toc":{"enable":false,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066cc","logo":"/images/logo.svg","favicon":"/images/logo.svg","avatar":"/images/avatar.svg","font_size":null,"font_family":null,"hover":{"shadow":false,"scale":false},"first_screen":{"enable":false,"header_transparent":false,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving.","font_color":null,"hitokoto":false},"scroll":{"progress_bar":false,"percent":false}},"local_search":{"enable":false,"preload":false},"code_copy":{},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":false},"lazyload":{"enable":false},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":false,"wordcount":false,"min2read":false},"img_align":"left","copyright_info":false},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original article title","author":"Original article author","link":"Original article link"}
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="logo-title" href="/">
               学习笔记
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">计算机系统</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/avatar.svg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">caijiQAQ</span>
                            
                                <span class="author-label">Lv2</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2023-06-03 20:24:59</span>
        <span class="mobile">2023-06-03 20:24</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-08-31 22:43:12</span>
    </span>
    
    
    

    
    
    
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <p>##程序的机器级表示<br>or S,D D&lt;——D|S<br>sub S,D D&lt;——D-S<br>%rax用于存放函数返回值<br>###移位操作<br>SAL、SHL：左移指令<br>SAR：算术移位 填上符号位<br>SHR：逻辑移位 填上0<br>###x86-64命名<br>延续字 2字节<br>双字 4字节<br>四字 8字节<br>八字 16字节<br>对应传送指令 字节<br>movb 传送字节 1<br>movw 传送字 2<br>movl 传送双字 4<br>movq 传送四字 8<br>指令与字节：<br><img src="https://cdn.jsdelivr.net/gh/caiji-QAQ/PICGO@master/20230705224241.png"><br>###跳转<br><img src="https://cdn.jsdelivr.net/gh/caiji-QAQ/PICGO@master/IMG_20230706_223245.jpg"><br>反汇编版本中是根据第二个字节的数值加上下一个指令的地址来判断跳转的地址，若出现f*这种情况则是负数(补码)，同样是与下一个指令的地址加和。<br>条件判断转移中第一种比较普通的方式：转移</p>
<pre><code>if（a&gt;b) goto state1
else goto state2
</code></pre>
<p>但这种情况一般情况下并不会使用，因为效率太低，计算机使用的是流水线的形式的提升效率，即可能在判断if的过程中已经开始编译下一步了，如果if判断为错就会让之前的编译白费。所以计算机一般是使用</p>
<pre><code>a1=a-b
a2 =b-a
c=a1&gt;a2
if c a1=a2
</code></pre>
<p>这种形式来提升效率</p>
<p>栈的地址与正常地址不同，是从底部开始向上递增。push进栈而pop从栈中读取数据。<br>call ret也用了同样的思想<br>程序计数器</p>
<p>开始的6个寄存器，如果参数的数量在6个以内则直接存放在下面的寄存器里，如果超出6个则会存在栈里，现在都是寄存器访问应用，因为寄存器速度要比栈中快很多<br><img src="https://cdn.jsdelivr.net/gh/caiji-QAQ/PICGO@master/20230808222154.png"></p>
<p>stackframe：对于每一个还没返回的函数会保留一个栈帧，一般栈帧由两个指针相隔，一个是栈指针%rsp，一个是基指针（%rbp）。大多数系统限制了栈的深度。<br>即使其他程序也使用了%rbp和%rsp，也一定会保证将值返还<br>每一个函数都有自身各自的堆栈地址，保证不会存在空间互相占用的情况。</p>
<p><strong>机器语言中没有数组的概念，那么数组是如何表示的</strong><br>地址+偏移值（基本类型大小）<br>ip+x，如果x是负数，也有效，并且也会比ip要小，当声明一个数组大小时，确确实实分配了已知大小的内存<br>多维数组地址排列情况<br><img src="https://cdn.jsdelivr.net/gh/caiji-QAQ/PICGO@master/20230819163754.png"><br>在创建结构的布局时，C编译器通常会加入填充字节让数据对齐。<br>数据对齐的好处：能让数据读取的更快（因为正常计算机一次会读取固定的量比如64bit，而且有的机器没有数据对齐会让内存出现问题。<br>下图也是由于要求双精度，令整个数据结构必须要在8字节边界上对齐：<br><img src="https://cdn.jsdelivr.net/gh/caiji-QAQ/PICGO@master/20230819170352.png"><br>对齐的优化也可以提升空间利用率，但编译器并不会主动去这么做来优化：<br><img src="https://cdn.jsdelivr.net/gh/caiji-QAQ/PICGO@master/20230819170643.png"></p>
<p>64位2机器限制只有47位的地址，所以可以支持的空间大小是：256*10^12字节，也就是256TB<br><strong>linux内存地址分布</strong><br>自地址低至地址高分别是：text data heap sharedlibraries stack<br>text：用于存放可执行程序的区域<br>data：用于存放程序开始时的数据，包括全局变量等<br>heap：用于存放通过malloc或相关的函数申请的变量，若一直申请但不释放地址也就会越来越大。在实际情况下，较大的变量会被分配在接近stack的一端，而较小的变量会分配在低地址这一端<br>stack：栈空间，该空间只有8MB，栈的分配从高到低，如果分配了一个调用8MB的指针就会出现问题不允许调用<br>总结：stack一般声明的是局部变量，而heap（malloc）一般是一小块或是一大块的变量<br><strong>缓冲区溢出</strong><br>输入目标大于缓冲区的大小。<br>在设置字符大小时注意给空字符留一位<br>为了避免缓冲区溢出可以使用更安全的写法：例如使用fgets来替换gets<br>fgets与gets的区别：fgets在输入字节超过规定的数字之后输入的字符串就会被截断，来保证不会缓冲区溢出。<br><strong>系统保护避免被攻击</strong><br>栈随机化（ASLR）：<br>地址空间布局随机化，这样就无法直接得到下一个地址，也就无法访问到系统代码，用于抵御蠕虫攻击。<br>将栈标记为不可执行：<br>这样不能把代码放在栈里。<br>canary（金丝雀）：<br>在地址上面的空间设置几个随机数，当溢出时canary的值就会被改变，可以检测到这个字节被修改。</p>
<p><strong>联合体</strong><br>在不同机器下，会得到不同的结果<br><img src="https://cdn.jsdelivr.net/gh/caiji-QAQ/PICGO@master/20230820194414.png"><br><strong>union和struct的区别</strong><br>struct和union同样声明了<br>xxx S3{<br>    char C;<br>    int i[2];<br>    double v;<br>}<br>struct所占用的空间是1+4+8&#x3D;13byte<br>union所占用的空间是他最大字段的大小因此是8byte<br>union引用的是数据结构的起始位置。<br><strong>数据对齐</strong><br>对齐要求保证结构体内数据类型起始地址是自身字节数倍数<br>1.struct P1{int i;char c;int j;char d;};<br>偏移量0 4 8 12 对齐要求 4<br>2，struct P2{short w[3];char c[3]}<br>偏移量0 6 对齐要求 </p>
<h2 id="05-程序优化"><a href="#05-程序优化" class="headerlink" title="05 程序优化"></a>05 程序优化</h2><p>1.优化编译器的能力<br>命令行选项选择-Og&#x2F;-O2&#x2F;-O3可以让编译器以不同等级优化。<br>2.微处理器结构以及程序指令<br>现代微处理器结构：<br>处理器具有超标量：可以在每个时钟周期执行多个操作，并且为乱序的，指令执行顺序不一定要与他们机器级程序中的顺序一致。整体设计有两个主要部分：指令控制单元和执行单元。<br>指令控制单元：从内存中读出指令系列并根据序列生成一组针对程序数据的基本操作。<br>执行单元：执行操作。<br>乱序处理器与按序流水线对比<br>乱序处理器需要更大、更复杂的硬件，但可以更好地达到更高的指令级并行度。</p>
<p>遇到分支的情况：<br>处理器采用一种<strong>分支预测</strong>的技术，处理器会猜测是否是否选择分支，同时也会预测分支的目标地址。使用投机执行的技术，拿出预测分支进行译码，当错误时会重新回到分支点的状态，开始取出和执行另一个方向上的指令。</p>
<p>收到实际的程序指令：<br>会将一个指令转换为一组基本操作，以好被并行执行</p>
<p>退役单元：<br>用于记录正在进行的操作，一条操作指令完成了，所有引起指令的分支点也都会被认为预测正确，则指令就退役了，后面的操作也会正常执行，如果分支预测错误，这条指令就会被清空，丢弃所有计算出的结果，用于防止预测错误改变程序的状态。</p>
<p>3.功能单元性能<br>三个指标<br>延迟：完成运算所需要的总时间<br>发射时间：两个连续的同类型的运算之间所需要的最小时钟周期数<br>容量：能够执行该运算的功能单元的数量。<br>延迟也就是一个操作的总量（几块），发射时间就是可以流水线的单位时间。比如整数乘法操作 延迟为3，发射时间为1，总量为3，每次输入到处理器1个块。</p>
<p>流水线、完全流水线化（发射时间为1）</p>
<p>针对一个硬件的性能：功能单元的最大吞吐量，定义为发射时间的倒数。对一个容量为C发射时间为I的操作来说，处理器可能的吞吐量为每个时钟周期C&#x2F;I个操作。<br>CPE每个元素的周期数。<br>延迟界限：完成合并原酸的函数所需要的最小CPE值（总量）<br>吞吐量界限：CPE最小界限（处理器能做的最好是多少）</p>
<h2 id="06-存储器层次结构"><a href="#06-存储器层次结构" class="headerlink" title="06 存储器层次结构"></a>06 存储器层次结构</h2><p><strong>存储器系统：</strong> 是一个具有不同容量成本和访问时间的存储设备的层次结构。主要分为：高速缓存(cache memory)，主存储器（main memory），磁盘。<br><strong>局部性：</strong> 具有良好局部性的程序倾向于一次又一次地访问相同的数据项集合，或是临近的数据项。良好局部性的程序较好可以从存储器层次结构较高的层次访问数据项，运行时间可以更短。<br>1.1随机访问存储器(RAM)<br>静态RAM(SRAM)：更快但空间更小，可以在CPU芯片上也可以在片下，不易受到干扰。<br>动态RAM(DRAM)：慢但空间较大，作为驻村和图形系统的缓冲区，更易受到干扰。<br><img src="https://cdn.jsdelivr.net/gh/caiji-QAQ/PICGO@master/20230831224239.png"></p>

            </div>

            

            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/2023/06/23/%E7%BB%8F%E6%B5%8E/"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">经济学习</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/2023/06/03/linux-%E6%8C%87%E4%BB%A4%E5%AD%A6%E4%B9%A0/"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">linux 指令学习</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
        </div>

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2020</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">caijiQAQ</a>
            
        </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>










<div class="post-scripts">
    
        
<script src="/js/post-helper.js"></script>

        
        
    
</div>



</body>
</html>
